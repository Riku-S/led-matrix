<style>
body{
	font-family: Arial;
}

code {
	background-color: #e0e8f0;
}

label {
	margin: 10px;
	display: block;
}

div {
	padding: 10px;
}
</style>

<body onload="initFunction()">
	<button onclick="setLanguage('English')">in English</button>, <button onclick="setLanguage('Finnish')">Suomeksi</button>
	<h1>PYNQ emulator</h1>
	<label lang="English">
		<h2>Content:</h2>
		<div>
			1. What is PYNQ emulator<br>
			2. How to use<br>
			2.1. Download the library and get started<br>
			2.2. Commands you may need<br>
			3. Known problems<br>
			4. Example code
		</div>
	</label>
	<label lang="Finnish">
		<h2>Sisältö:</h2>
		<div>
			1. Mikä on PYNQ-emulaattori<br>
			2. Käyttöohje<br>
			2.1. Kirjaston lataaminen ja aloitus<br>
			2.2. Komentoja joita voit tarvita<br>
			3. Tunnetut ongelmat<br>
			4. Esimerkkikoodi
		</div>
	</label>
	<label lang="English">
		<h2>1. What is PYNQ emulator</h2>
		<div>
			About real PYNQ: <a href="">https://www.pynq.io</a><br>
			<br>
			The PYNQ emulator is a Python library programmed using tkinter.
			The emulator was made to simulate the functionalities of the original PYNQ device
			and the Python library that TUNI uses to program on the devices.<br>
			The project's home page is <a href="https://github.com/Riku-S/led-matrix">https://github.com/Riku-S/led-matrix</a>
		</div>
		
	</label>
	<label lang="Finnish">
		<h2>1. Mikä on PYNQ-emulaattori</h2>
		<div>
			Oikeasta PYNQ:istä: <a href="">https://www.pynq.io</a><br>
			<br>
			PYNQ-emulaattori on Python-kirjasto, joka on ohjelmoitu tkinter-kirjoston avulla.
			Emulaattori on tehty simuloimaan oikean PYNQ-laitteen toimintoja, ja siihen liittyvää,
			TUNI:n käyttämää Python-kirjastoa, jolla laitteille pystyy ohjelmoimaan. <br>
			Projektin kotisivu on <a href="https://github.com/Riku-S/led-matrix">https://github.com/Riku-S/led-matrix</a>
		</div>
		
	</label>
	
	<img src="screenshot.png"; alt="Screenshot with instructions">
	
	<label lang="English">
		<h2>2. How to use</h2>
		<h3>2.1. Download the library and get started:</h3>
		<div>
			<b>Note: The following instructions assume you use PyCharm, since it's the coding IDE used by most of TUNI students.</b><br>
			To get started, create a new project in PyCharm. Open <i>Terminal</i> tab from the menu in the bottom left of the window. 
			Execute command <code>pip install pynq-emulator</code> in the terminal to download and install the pynq-emulator package. <br>
			<br>
			Downloading packages with PyCharm is not the only way thoough, so if you use another IDE or want to use a better way 
			to dowloading packages, learn about downloading packages with pip: <a href="https://packaging.python.org/tutorials/installing-packages/">Installing Packages --- Python Packaging User Guide</a><br>
			<br>
			Import the contents in your code by writing <code>from pynq_emulator.emulation import *</code>, but remember that in the final product
			with an actual hardware, the import commands you should use are 
			<code>import tut.arduino_led_matrix as led_matrix</code>,
			<code>from pynq.lib import Button</code> and
			<code>from pynq.lib import Switch</code> <br>
			You can write your own code as you would write it for PYNQ, or modify the example code in the end of this document, to get started. Run your code to see if everything works. Close the simulation from your coding IDE rather than by closing the window.
		</div>
		<h3>2.2. Commands and variables you may need:</h3>
		<div>
			<code>pip install pynq-emulator</code> Run the command in your coding environment's terminal, (or another command prompt, see <a href="https://packaging.python.org/tutorials/installing-packages/">Installing Packages --- Python Packaging User Guide</a>) to download the emulator package. <br>
			<br>
			<code>from pynq_emulator.emulation import *</code> Use the library in your python file. <br>
			<br>
			<code>led_matrix.clear()</code> Set all the LEDs dark.<br>
			<code>led_matrix.init()</code> Always start your simulation with this!<br>
			<code>led_matrix.read_sensor()</code> Read the light sensor's value. In the simulation you can adjust it between 0 and 20000.<br>
			<code>led_matrix.set_led_color(x: int, y: int, red: int, green: int, blue: int)</code> Set a light level for the red, green and blue LED lights in the coordinates (x, y). The colors may have values between 0 and 255.<br>
			<br>
			<code>Button(id: int)</code> Returns the button with the given index.<br>
			<code>Button.read()</code> Returns the state of the button, 0 or 1<br>
			<code>Button.wait_for_value(value: int)</code> Don't do anything before the button gets the value 0 or 1<br>
			<br>
			<code>Switch(id: int)</code> Returns the switch with the given index.<br>
			<code>Switch.read()</code> Returns the state of the switch, 0 or 1<br>
			<code>Switch.wait_for_value(value: int)</code> Don't do anything before the switch gets the value 0 or 1<br>
		</div>
	</label>
	
	<label lang="Finnish">
		<h2>2. Käyttöohje</h2>
		<h3>2.1. Kirjaston lataaminen ja aloitus:</h3>
		<div>
			<b>Huomio: Seuraavassa osiossa oletetaan, että käytät PyCharmia, sillä suurin osa TUNI:n opiskelijoista käyttää sitä tehtävien tekoon.</b><br>
			Päästäksesi alkuun, aloita uusi projekti PyCharmissa. Avaa <i>Terminal</i> välilehti ikkunan alhaalla vasemmalla olevasta valikosta.
			Suorita terminaalissa komento <code>pip install pynq-emulator</code><br> ladataksesi pynq-emulaator-kirjaston.<br>
			<br>
			Paketteja voi ladata muutenkin, kuin PyCharmin kautta, joten jos käytät toista ohjelmaa, tai haluat käyttää pidemmän päälle parempaa tapaa 
			ladata paketteja, lue pakettien lataamisesta pip:illä: <a href="https://packaging.python.org/tutorials/installing-packages/">Installing Packages --- Python Packaging User Guide</a><br>
			<br>
			Importtaa moduulin sisältö koodissa kirjoittamalla <code>from pynq_emulator.emulation import *</code>, mutta muista, että lopullisessa tuotteesssa
			oikealla laitteella, import-komentoihin kuuluu 
			<code>import tut.arduino_led_matrix as led_matrix</code>,
			<code>from pynq.lib import Button</code> ja 
			<code>from pynq.lib import Switch</code> <br>
			Voit kirjoittaa koodia niinkuin kirjoittaisit sitä PYNQ:ille, tai muokata esimerkkikoodia dokumentaation lopussa, päästäksesi alkuun. Aja koodisi nähdäksesi, että kaikki toimii. Sulje simulaatio mieluiten PyCharmin punaisesta neliöstä.
		</div>
		<h3>2.2. Komentoja joita voit tarvita:</h3>
		<div>
			<code>pip install pynq-emulator</code> Ohjhelmointiympäristön terminaalissa, (tai muussa komentotulkissa, katso <a href="https://packaging.python.org/tutorials/installing-packages/">Installing Packages --- Python Packaging User Guide</a>) suoritettava komento, jolla voi ladata emulaattori-paketin. <br>
			<br>
			<code>from pynq_emulator.emulation import *</code> Ota kirjasto käyttöön python-tiedostossa.<br>
			<br>
			<code>led_matrix.clear()</code> Pimennä kaikki ledit.<br>
			<code>led_matrix.init()</code> Aloita simulaatio aina tällä komennolla!<br>
			<code>led_matrix.read_sensor()</code> Lue valosensorin arvo. Simulaatiossa voi säädellä sitä 0-20000 välillä.<br>
			<code>led_matrix.set_led_color(x: int, y: int, punainen: int, vihreä: int, sininen: int)</code> Aseta punaisen, vihreän ja sinisen valon määrä koordinaatteihin (x, y). Värien arvot tulee asettaa välille 0 ja 255.<br>
			<br>
			<code>Button(id: int)</code> Palauttaa kyseisen numeroisen napin.<br>
			<code>Button.read()</code> Palauttaa napin tilan, 0 tai 1<br>
			<code>Button.wait_for_value(arvo: int)</code> Älä tee mitään ennen kuin nappi saa arvon 0 tai 1<br>
			<br>
			<code>Switch(id: int)</code> Palauttaa kyseisen numeroisen vivun.<br>
			<code>Switch.read()</code> Palauttaa vivun tilan, 0 tai 1<br>
			<code>Switch.wait_for_value(arvo: int)</code> Älä tee mitään ennen kuin vipu saa arvon 0 tai 1<br>
		</div>
	</label>
	
	<label lang="English">
		<h2>3. Known problems:</h2>
		<div>
			Repeated <code>.read()</code> and <code>.wait_for_value()</code> functions aren't necessarily the most accurate possible. For example, writing <br>
			<code style=" white-space: pre-wrap; ">
if my_button.read(1):
	my_button.wait_for_value(0)</code> may soft lock the hardware PYNQ while it behaves in a more predictable way in the simulation.<br>
			<br>
			As long as I keep using tkinter, threading won't work due to breaking the drawing functions.<br>
			<br>
			Keep in mind that the testing process has been very shorthanded, since the programmer of the emulator doesn't own a PYNQ. The features are mainly made after the descriptions of the PYNQ-exercises. The error messages differ from the real device and may be caused by wrong reasons. For example, an earlier version of the emulator let you try to light up LEDs that wouldn't exist, without giving an error message, and continue the program, which is not the case in the real device. <br>
			<br>
			If you notice something wrong yourself, or want to give feedback of any kind, please feel free to send mail at riku.salminen@tuni.fi. Feedback is very welcome.
		</div>
	</label>
		<label lang="Finnish">
		<h2>3. Tunnetut ongelmat:</h2>
		<div>
			Peräkkäiset <code>.read()</code> ja <code>.wait_for_value()</code> funktiot eivät ole välttämättä tarkimpia mahdollisia. Esimerkiksi<br>
			<code style=" white-space: pre-wrap; ">
if my_button.read(1):
	my_button.wait_for_value(0)</code> voi saada PYNQ:in jumiin, vaikka simulaatio käyttäytyisi arvattavammin.<br>
			<br>
			Niin kauan kun käytän tkinteriä, threading tuhoaa piirtofunktiot.<br>
			<br>
			Pidä mielessä, että ohjelman testaaminen on ollut erittäin vajaata. Ominaisuudet on suurimmalta osin tehty PYNQ-tehtävien tehtävänantojen antamien kuvauksien perusteella. Virheilmoitukset ovat erit, kuin oikealla laitteella, ja saattavat seurata vääristä asioista. Esimerkiksi emulaattorin aiempi versio antoi käyttäjän yrittää sytyttää ledin matriisin ulkopuolelta antamatta virheilmoitusta ja jatkaen ohjelman suoritusta, eroten oikeasta laitteesta.<br>
			<br>
			Jos huomaat jotakin olevan pielessä, tai haluat antaa mitä tahansa palautetta, lähetä viestiä osoitteeseen riku.salminen@tuni.fi. Palaute on erittäin tervetullutta.
		</div>
	</label>
	
	<label lang="Any">
		<h2>4. example.py:</h2>
		<code style=" white-space: pre-wrap; display: block;"># PYNQ led matrix simulator example

# Remember not to import this in your final product
from pynq_emulator.emulation import *

# These could be imported instead
# import tut.arduino_led_matrix as led_matrix
# from pynq.lib import Button
# from pynq.lib import Switch

import time


def set_all_leds(red, green, blue):
    """ Set the color value to all the LEDs

    :param red: Red value between 0 and 255
    :param green: Green value between 0 and 255
    :param blue: Blue value between 0 and 255
    :return: None
    """
    for i in range(8):
        for j in range(8):
            led_matrix.set_led_color(i, j, red, green, blue)


def main():
    # Always remember to initialize the led matrix!
    led_matrix.init()

    button0 = Button(0)
    switch0 = Switch(0)

    # Let's first set all LEDs green

    red = 0
    green = 255
    blue = 0

    set_all_leds(red, green, blue)

    # Advance to the next step when switch 0 is turned on
    switch0.wait_for_value(1)

    # From this point on the LEDs are red
    red = 255
    green = 0

    # Stop the program by turning off the switch
    while switch0.read() == 1:

        # If button 1 is pressed, turn the LEDs magenta colored
        # (full red + full blue)
        if button0.read() == 1:
            blue = 255
        else:
            blue = 0

        set_all_leds(red, green, blue)

        # Add a little delay between checks
        time.sleep(0.1)

    # Ending the simulation doesn't shut down the LEDs in real life
    led_matrix.clear()


main()
		</code>
	</label>
	
</body>

<script>
function setLanguage(language) {
	var list = document.getElementsByTagName("LABEL");
	for(var i = 0; i < list.length; i++){
		var entry = list[i];
		if(entry.lang == language || entry.lang=="Any")
			entry.style.display = "block";
		else
			entry.style.display = "none";
	}
}

function initFunction() {
	setLanguage("Finnish");
	var body = document.getElementsByTagName("body")[0];
	body.style.display = "block";
}
</script>
